import math
import numpy as np

print('loading vertiport configuration')


def pointy_hex_corner(center, size, i):
    angle_deg = 60 * i
    angle_rad = math.radians(angle_deg)
    return (center[0] + size * math.cos(angle_rad),
            center[1] + size * math.sin(angle_rad))


class Config:
    # experiment setting
    no_episodes = 1000000

    # airspace setting
    window_width = 800
    window_height = 800
    diagonal = window_height * math.sqrt(2)
    num_aircraft = 10
    EPISODES = 1000000
    G = 9.8
    tick = 30
    scale = 60  # 1 pixel = 60 meters

    # distance param
    minimum_separation = 926 / scale
    NMAC_dist = 150 / scale
    horizon_dist = 4000 / scale
    initial_min_dist = 3000 / scale
    goal_radius = 600 / scale

    # speed
    init_speed = 190 / 3.6 / scale
    min_speed = 45 / scale
    max_speed = 220 / 3.6 / scale
    # d_speed = 0 / scale
    speed_sigma = 5 / scale
    # position_sigma = 0 / scale

    # heading in rad TBD
    d_heading = math.radians(5)
    heading_sigma = math.radians(2)

    # MCTS algorithm
    no_simulations = 100
    search_depth = 3
    no_simulations_lite = 30
    search_depth_lite = 2
    simulate_frame = 10

    # reward setting
    NMAC_penalty = -10 / 10
    conflict_penalty = -5 / 10
    wall_penalty = -10 / 10
    step_penalty = -0.01 / 10
    goal_reward = 10 / 10
    conflict_coeff = 0.005
    goal_importance = 0.0005
    sparse_reward = True

    n_closest = 4

    # vertiport parameter
    start_safe_dist = 3 * minimum_separation
    time_interval_lower = 60
    time_interval_upper = 120
    vertiport_loc = np.zeros([7, 2])
    vertiport_center = np.array([window_width / 2, window_height / 2])
    vertiport_loc[0, :] = vertiport_center
    for i in range(1, 7):
        vertiport_loc[i, :] = pointy_hex_corner(vertiport_center, size=300, i=i)

    # point
    point_len = 4
    point = np.array([[-point_len, -point_len],
                      [point_len, -point_len],
                      [point_len, point_len],
                      [-point_len, point_len],
                      [-point_len, -point_len]])

    # square
    square_len = 5
    vertices = np.array([[-square_len, -square_len],
                         [square_len, -square_len],
                         [square_len, square_len],
                         [-square_len, square_len],
                         [-square_len, -square_len]])
    sector_exit_len = 10

    # sector vertices
    sector_vertices = np.array([
        [[0., 0.],
         [0., 2.],
         [2., 0.],
         [2., 2.]],

        [[400., 400.],
         [700., 919.61524227],
         [850., 659.80762114],
         [400., 919.61524227]],

        [[400., 400.],
         [100., 919.61524227],
         [400., 919.61524227],
         [-50., 659.80762114]],

        [[400., 400.],
         [-200., 400.],
         [-50., 659.80762114],
         [-50., 140.19237886]],

        [[400., 400.],
         [100., -119.61524227],
         [-50., 140.19237886],
         [400., -119.61524227]],

        [[400., 400.],
         [700., -119.61524227],
         [400., -119.61524227],
         [850., 140.19237886]],

        [[400., 400.],
         [1000., 400.],
         [850., 140.19237886],
         [850., 659.80762114]]])

    sector_entries = np.array([
        [[1., 1.],
         [0.4, 0.],
         [0.8, 0.],
         [0.6, 0.6]],

        [[400., 659.80762114],
         [490., 451.96152423],
         [580., 503.92304845],
         [400., 555.88457268]],

        [[175., 529.90381057],
         [400., 503.92304845],
         [400., 607.84609691],
         [265., 477.94228634]],

        [[175., 270.09618943],
         [310., 451.96152423],
         [220., 503.92304845],
         [265., 322.05771366]],

        [[400., 140.19237886],
         [310., 348.03847577],
         [220., 296.07695155],
         [400., 244.11542732]],

        [[625., 270.09618943],
         [400., 296.07695155],
         [400., 192.15390309],
         [535., 322.05771366]],

        [[625., 529.90381057],
         [490., 348.03847577],
         [580., 296.07695155],
         [535., 477.94228634]]])

    sector_len_exits = np.array([
        [[[0., 0.],
          [0., 0.],
          [0., 0.]],

         [[0., 0.],
          [0., 0.],
          [0., 0.]],

         [[0., 0.],
          [0., 0.],
          [0., 0.]],

         [[0., 0.],
          [0., 0.],
          [0., 0.]]],

        [[[625., 529.90381057],
          [616.33974596, 524.90381057],
          [616.33974596, 524.90381057]],

         [[535., 477.94228634],
          [526.33974596, 472.94228634],
          [543.66025404, 482.94228634]],

         [[400., 503.92304845],
          [400., 493.92304845],
          [400., 513.92304845]],

         [[400., 607.84609691],
          [400., 597.84609691],
          [400., 617.84609691]]],

        [[[400., 659.80762114],
          [400., 649.80762114],
          [400., 649.80762114]],

         [[400., 555.88457268],
          [400., 545.88457268],
          [400., 565.88457268]],

         [[310., 451.96152423],
          [318.66025404, 446.96152423],
          [301.33974596, 456.96152423]],

         [[220., 503.92304845],
          [228.66025404, 498.92304845],
          [211.33974596, 508.92304845]]],

        [[[175., 529.90381057],
          [183.66025404, 524.90381057],
          [183.66025404, 524.90381057]],

         [[265., 477.94228634],
          [273.66025404, 472.94228634],
          [256.33974596, 482.94228634]],

         [[310., 348.03847577],
          [318.66025404, 353.03847577],
          [301.33974596, 343.03847577]],

         [[220., 296.07695155],
          [228.66025404, 301.07695155],
          [211.33974596, 291.07695155]]],

        [[[175., 270.09618943],
          [183.66025404, 275.09618943],
          [183.66025404, 275.09618943]],

         [[265., 322.05771366],
          [273.66025404, 327.05771366],
          [256.33974596, 317.05771366]],

         [[400., 296.07695155],
          [400., 306.07695155],
          [400., 286.07695155]],

         [[400., 192.15390309],
          [400., 202.15390309],
          [400., 182.15390309]]],

        [[[400., 140.19237886],
          [400., 150.19237886],
          [400., 150.19237886]],

         [[400., 244.11542732],
          [400., 254.11542732],
          [400., 234.11542732]],

         [[490., 348.03847577],
          [481.33974596, 353.03847577],
          [498.66025404, 343.03847577]],

         [[580., 296.07695155],
          [571.33974596, 301.07695155],
          [588.66025404, 291.07695155]]],

        [[[625., 270.09618943],
          [616.33974596, 275.09618943],
          [616.33974596, 275.09618943]],

         [[535., 322.05771366],
          [526.33974596, 327.05771366],
          [543.66025404, 317.05771366]],

         [[490., 451.96152423],
          [481.33974596, 446.96152423],
          [498.66025404, 456.96152423]],

         [[580., 503.92304845],
          [571.33974596, 498.92304845],
          [588.66025404, 508.92304845]]]])
